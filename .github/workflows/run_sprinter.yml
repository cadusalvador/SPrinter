name: Executar SPrinter (a cada 1h20)

on:
  schedule:
    # ExecuÃ§Ãµes a cada 1h20: 00:00, 01:20, 02:40, 04:00, ...
    - cron: '0 0-23/1 * * *'
    - cron: '20 1-23/1 * * *'
    - cron: '40 2-23/1 * * *'
  workflow_dispatch:

jobs:
  executar_sprinter:
    runs-on: ubuntu-latest
    name: Rodar SPrinter automaticamente

    steps:
      - name: ðŸ“¥ Baixar cÃ³digo
        uses: actions/checkout@v3

      - name: ðŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ðŸ“¦ Instalar dependÃªncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: âš™ï¸ Configurar variÃ¡veis de ambiente
        run: |
          echo "LOOKER_URL=${{ secrets.LOOKER_URL }}" >> $GITHUB_ENV
          echo "LOOKER_URL_VISAO_GERAL=${{ secrets.LOOKER_URL_VISAO_GERAL }}" >> $GITHUB_ENV
          echo "APP_ID=${{ secrets.APP_ID }}" >> $GITHUB_ENV
          echo "APP_SECRET=${{ secrets.APP_SECRET }}" >> $GITHUB_ENV
          echo "LINK_APP_TOKEN=${{ secrets.LINK_APP_TOKEN }}" >> $GITHUB_ENV
          echo "SEATALK_WEBHOOK=${{ secrets.SEATALK_WEBHOOK }}" >> $GITHUB_ENV
          echo "CHROME_DRIVER_PATH=${{ secrets.CHROME_DRIVER_PATH }}" >> $GITHUB_ENV
          echo "PRINT_PATH=${{ secrets.PRINT_PATH }}" >> $GITHUB_ENV
          echo "BINARY_LOCATION=${{ secrets.BINARY_LOCATION }}" >> $GITHUB_ENV
          echo "PAGE_LOAD_TIMEOUT=${{ secrets.PAGE_LOAD_TIMEOUT }}" >> $GITHUB_ENV
          echo "HEADLESS=${{ secrets.HEADLESS }}" >> $GITHUB_ENV

      - name: ðŸ§° Instalar Google Chrome e ChromeDriver
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb
          DRIVER_VERSION=$(curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_141")
          wget -O /tmp/chromedriver.zip "https://chromedriver.storage.googleapis.com/${DRIVER_VERSION}/chromedriver_linux64.zip"
          unzip /tmp/chromedriver.zip -d /usr/local/bin/
          chmod +x /usr/local/bin/chromedriver

      - name: ðŸš€ Executar SPrinter
        run: |
          echo "==== INICIANDO EXECUÃ‡ÃƒO $(date) ===="
          python main.py
          echo "==== EXECUÃ‡ÃƒO FINALIZADA $(date) ===="
